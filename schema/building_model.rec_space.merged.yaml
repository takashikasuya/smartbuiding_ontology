id: https://www.sbco.or.jp/ont/schema
name: building_model
title: Smart Building Model
description: 'A LinkML schema for sites, buildings, spaces, equipment, and points
  used in smart-building data exchanges.

  '
default_prefix: sbco
default_range: string
prefixes:
  linkml: https://w3id.org/linkml/
  sbco: https://www.sbco.or.jp/ont/
  gutp: https://smart-building-ontology.org/gutp/
  rec: https://w3id.org/rec/
  brick: https://brickschema.org/schema/Brick#
  bot: https://w3id.org/bot#
  xsd: http://www.w3.org/2001/XMLSchema#
  rdfs: http://www.w3.org/2000/01/rdf-schema#
imports:
- linkml:types
enums:
  UnitEnum:
    description: Allowed measurement units
    permissible_values:
      celsius:
        description: Degree Celsius
        annotations:
        - tag: text
          value: °C
      percent:
        description: Percent
        annotations:
        - tag: text
          value: '%'
      ppm:
        description: Parts per million
        annotations:
        - tag: text
          value: ppm
slots:
  id:
    description: Stable identifier (local or global)
    required: true
    identifier: true

  name:
    description: Human-readable name
    range: string

  description_text:
    description: Description (English). For multilingual, see annotations on each
      object.

  sites:
    description: Sites contained by a higher-level container (rarely used)
    range: Site
    multivalued: true
    inlined_as_list: true
  buildings:
    description: Buildings in a site
    range: Building
    multivalued: true
    inlined_as_list: true
  levels:
    description: Levels in a building
    range: Level
    multivalued: true
    inlined_as_list: true
  spaces:
    description: Spaces within a building or level
    range: Space
    multivalued: true
    inlined_as_list: true
  equipment_list:
    description: Equipment installed in a space
    range: Equipment
    multivalued: true
    inlined_as_list: true
  points:
    description: Points (sensors/actuators) attached to equipment
    range: Point
    multivalued: true
    inlined_as_list: true
  site:
    description: Parent site
    range: Site
  building:
    description: Parent building
    range: Building
  level:
    description: Parent level
    range: Level
  space:
    description: Parent space
    range: Space
  equipment:
    description: Parent equipment
    range: Equipment

  enabled:
    description: Whether the point is enabled/active
    range: boolean
    ifabsent: true
  point_type:
    description: "Point type - a profile or template name used to refer to the telemetry format obtainable from the device or point. Specific definitions are provided separately in schema files."
    range: string
    required: true
    annotations:
      - tag: description_ja
        value: "ポイントタイプ - 機器やポイントから取得できるテレメトリのフォーマットを参照するためのプロファイル名、またはテンプレート名。具体的な定義については、スキーマファイル等で当該タイプについては別途定義される。"
  unit:
    description: Measurement unit (enum key; symbol can be taken from annotations)
    range: UnitEnum
  min_pres_value:
    description: Minimum plausible reading
    range: float
  max_pres_value:
    description: Maximum plausible reading
    range: float
  key:
    range: string
    identifier: true
  value:
    range: string
  flag:
    range: boolean
  entries:
    description: 内側の string->string エントリ
  dtmi:
    description: Digital Twin Model Identifier (DTMI)
    range: Dtmi
    pattern: ^dtmi:org:w3id:rec:Space;1$
  identifiers:
    description: map(string -> string)
    multivalued: true
    range: KeyStringMapEntry
    inlined: true
    inlined_as_list: true
  customTags:
    description: map(string -> boolean)
    multivalued: true
    range: KeyBoolMapEntry
    inlined: true
    inlined_as_list: true
  customProperties:
    description: map(string -> map(string -> string))
    multivalued: true
    range: KeyMapOfStringMapEntry
    inlined: true
    inlined_as_list: true

  geometry:
    description: Polygon representing the spatial extent of this Space.
    range: Geometry
    multivalued: false

  georeference:
    description: A georeference creates a relationship between the local coordinate system used within a building (e.g., measured in meters) and a geographic coordinate system (e.g., lat, long, alt), such that locally placed Spaces can be resolved and rendered in that geographic coordinate system (e.g., for mapping purposes).
    range: Georeference
    multivalued: false

  hasPart:
    description: The subject is composed in part of the entity given by the object.
    any_of:
      - range : Space
      - range : Resource
    multivalued: true

  isPartOf:
    range: Space
    any_of:
      - range : Space
      - range : Resource
    multivalued: false

  isLocationOf:
    description: Subject is the physical location encapsulating the object.
    range: Resource
    multivalued: true

  # Asset specific slots
  assetTag:
    description: "Asset identification tag"
    range: string
    slot_uri: rec:assetTag
    multivalued: true
    
  commissionedBy:
    description: "Agent or resource that commissioned this asset"
    any_of:
      - range: Resource
      - range: Agent
    multivalued: true
    slot_uri: rec:commissionedBy
    
  commissioningDate:
    description: "Date when the asset was commissioned"
    range: date
    slot_uri: rec:commissioningDate
    
  documentation:
    description: "Documentation related to this asset"
    any_of:
      - range: Resource
      - range: Document
    multivalued: true
    slot_uri: rec:documentation
    
  initialCost:
    description: "Initial cost of the asset"
    range: string  # Using string for rdfs:Literal
    slot_uri: rec:initialCost
    
  installationDate:
    description: "Date when the asset was installed"
    range: date
    slot_uri: rec:installationDate
    exact_mappings:
      - xsd:date  # XSD date型との正確なマッピングを明示
      
  installedBy:
    description: "Agent or resource that installed this asset"
    any_of:
      - range: Resource
      - range: Agent
    multivalued: true
    slot_uri: rec:installedBy
    
  IPAddress:
    description: "IP address of the asset"
    range: string
    pattern: "^((25[0-5]|2[0-4]\\d|1?\\d?\\d)\\.){3}(25[0-5]|2[0-4]\\d|1?\\d?\\d)$"
    multivalued: true
    slot_uri: rec:IPAddress
    
  locatedIn:
    description: "Space where this asset is located"
    any_of:
      - range: Resource
      - range: Space
    multivalued: true
    slot_uri: rec:locatedIn
    
  MACAddress:
    description: "MAC address of the asset"
    range: string
    pattern: "^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$"
    multivalued: true
    slot_uri: rec:MACAddress
    
  maintenanceInterval:
    description: "Maintenance interval duration"
    range: xsd:duration
    multivalued: true
    slot_uri: rec:maintenanceInterval
    pattern: "^P(?:\\d+Y)?(?:\\d+M)?(?:\\d+D)?(?:T(?:\\d+H)?(?:\\d+M)?(?:\\d+(?:\\.\\d+)?S)?)?$"
    
  manufacturedBy:
    description: "Agent or resource that manufactured this asset"
    any_of:
      - range: Resource
      - range: Agent
    multivalued: true
    slot_uri: rec:manufacturedBy
    
  mountedOn:
    description: "Building element on which this asset is mounted"
    any_of:
      - range: Resource
      - range: BuildingElement
    slot_uri: rec:mountedOn
    
  servicedBy:
    description: "Agent or resource that services this asset"
    any_of:
      - range: Resource
      - range: Agent
    multivalued: true
    slot_uri: rec:servicedBy
    
  turnoverDate:
    description: "Date when the asset was turned over"
    range: date
    slot_uri: rec:turnoverDate
    exact_mappings:
      - xsd:date
    
  weight:
    description: "Weight of the asset"
    range: decimal
    slot_uri: rec:weight
    exact_mappings:
      - xsd:decimal
      
  # Agent specific slots
  isMemberOf:
    description: "Organization that this agent is a member of"
    any_of:
      - range: Resource
      - range: Organization
    multivalued: true
    slot_uri: rec:isMemberOf
    
  owns:
    description: "Resources owned by this agent"
    range: Resource
    multivalued: true
    slot_uri: rec:owns

classes:
  Space:
    class_uri: rec:Space
    description: A contiguous part of the physical world that contains or can contain sub-spaces. E.g., a Region can contain many Sites, which in turn can contain many Buildings.
    annotations:
    - tag: description_ja
      value: 室やゾーンなどの空間単位。設備を含みうる。
    slots:
    - costom_properties
    - custom_tags
    - identifiers
    - name
  
  Architecture:
    is_a: Space
    class_uri: rec:Architecture
    description: A designed/landscaped (or potentially designed/landscaped) part of the physical world that has a 3D spatial extent. E.g., a building site, a building, levels within the building, rooms, etc.
    slots:
    - id
    - name
    - description_text
    - custom_tags
  Site:
    is_a: Architecture
    class_uri: rec:Site
    description: A piece of land upon which zero or more buildings may be situated.
    annotations:
    - tag: description_ja
      value: サイト。複数の建物を含みうる。
    slots:
    - id
    - name
    - description_text
    - custom_tags
    - buildings
  Building:
    class_uri: bot:Building
    description: A building which is part of a site.
    annotations:
    - tag: description_ja
      value: サイトの一部である建物。
    slots:
    - id
    - name
    - description_text
    - custom_tags
    - site
    - levels
    - spaces
  Level:
    class_uri: bot:Storey
    description: A building storey. Levels can also be treated as a kind of space.
    annotations:
    - tag: description_ja
      value: 建物のフロア。スペースの一種として扱える。
    slots:
    - id
    - name
    - description_text
    - custom_tags
    - building
    - spaces

  Equipment:
    is_a: Asset
    class_uri: rec:Equipment
    description: "An equipment asset installed in a space."
    annotations:
    - tag: description_ja
      value: "空間に設置された設備アセット。"
    slots:
    - space
    - manufacturer
    - points
    
    slot_usage:
      locatedIn:
        range: Space  # Equipment is specifically located in spaces
  Point:
    class_uri: rec:Point
    description: A sensor, actuator, or data point associated with equipment.
    annotations:
    - tag: description_ja
      value: 設備に紐づくセンサー/アクチュエータ/データポイント。
    slots:
    - id
    - name
    - description_text
    - custom_tags
    - equipment
    - enabled
    - point_type
    - unit
    - min_pres_value
    - max_pres_value
    rules:
    - description: Temperature points should have reasonable range and Celsius unit
      preconditions:
        slot_conditions:
          point_type: Temperature
      postconditions:
        slot_conditions:
          unit:
            equals_string: celsius
          max_pres_value:
            maximum_value: 100
            minimum_value: -50
    - description: Humidity points must be 0–100% range
      preconditions:
        slot_conditions:
          point_type: Humidity
      postconditions:
        slot_conditions:
          unit:
            equals_string: percent
          max_pres_value:
            maximum_value: 100
            minimum_value: 0
    - description: CO2 points should have a reasonable ppm range
      preconditions:
        slot_conditions:
          point_type: CO2
      postconditions:
        slot_conditions:
          unit:
            equals_string: ppm
          max_pres_value:
            maximum_value: 10000
            minimum_value: 0
  KeyStringMapEntry:
    description: map(string -> string) の1エントリ
    slots:
    - key
    - value
    slot_usage:
      key:
        required: true
      value:
        required: true
  KeyBoolMapEntry:
    description: map(string -> boolean) の1エントリ
    slots:
    - key
    - flag
    slot_usage:
      key:
        required: true
      flag:
        required: true
  KeyMapOfStringMapEntry:
    description: map(string -> map(string -> string)) の1エントリ
    slots:
    - key
    - entries
    slot_usage:
      key:
        required: true
      entries:
        multivalued: true
        range: KeyStringMapEntry
        inlined: true
        inlined_as_list: true
  Geometry:
    description: REC Geometry のプレースホルダ（詳細は別途拡張）
  Georeference:
    description: REC Georeference のプレースホルダ（詳細は別途拡張）
  # Base Resource class (if not already defined)
  Resource:
    class_uri: rdfs:Resource
    description: "Base class for all resources"
    slots:
      - id
      - name
      - description_text
  
  # Document class (if not already defined)
  Document:
    is_a: Resource
    class_uri: rec:Document
    description: "A document providing information about a building element or asset"
    slots:
      - id
      - name
      - description_text
  
  # BuildingElement class extending Resource
  BuildingElement:
    is_a: Resource
    class_uri: rec:BuildingElement
    description: "A part that constitutes a piece of a building's structural makeup. E.g., Facade, Wall, Slab, Roof, etc."
    annotations:
      - tag: description_ja
        value: "建物の構造的構成要素。例：ファサード、壁、スラブ、屋根など。"
    slots:
      - id
      - name
      - description_text
      - custom_tags
      - documentation
      - hasPart
      - isPartOf
      - locatedIn
    
    slot_usage:
      documentation:
        any_of:
          - range: Resource
          - range: Document
        multivalued: true

      locatedIn:
        any_of:
          - range: Resource
          - range: Architecture
        multivalued: false

  # Update mountedOn slot to properly reference BuildingElement
  Asset:
    # ...existing Asset definition...
    slot_usage:
      mountedOn:
        any_of:
          - range: Resource
          - range: BuildingElement
        slot_uri: rec:mountedOn
types:
  Dtmi:
    typeof: string
    pattern: ^dtmi:[A-Za-z0-9:._-]+;[0-9]+$
    description: Digital Twin Model Identifier (DTMI) format
